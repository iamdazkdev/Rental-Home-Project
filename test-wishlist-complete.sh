#!/bin/bash

echo "ğŸ§ª TESTING WISHLIST FEATURE - COMPLETE"
echo "======================================"
echo ""

# Check servers
echo "ğŸ“¡ 1. Checking servers..."
SERVER_RUNNING=false
CLIENT_RUNNING=false

if lsof -i :5000 >/dev/null 2>&1; then
  echo "   âœ… Server is running (port 5000)"
  SERVER_RUNNING=true
else
  echo "   âŒ Server NOT running - please start it!"
  echo "      cd server && npm start"
fi

if lsof -i :3000 >/dev/null 2>&1; then
  echo "   âœ… Client is running (port 3000)"
  CLIENT_RUNNING=true
else
  echo "   âŒ Client NOT running - please start it!"
  echo "      cd client && npm start"
fi

if [ "$SERVER_RUNNING" = false ] || [ "$CLIENT_RUNNING" = false ]; then
  echo ""
  echo "âš ï¸  Please start both servers before testing!"
  exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ WISHLIST FEATURE TEST CHECKLIST"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… Backend Changes:"
echo "   â€¢ User model: wishList uses ObjectId refs"
echo "   â€¢ User route: PATCH /user/:userId/:listingId"
echo "   â€¢ Toggle logic: Add/Remove based on existence"
echo ""
echo "âœ… Frontend Changes:"
echo "   â€¢ ListingCard: Fixed wishlist logic"
echo "   â€¢ WishList page: Auto-refresh with useMemo"
echo "   â€¢ Redux: setWishList action"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª TEST SCENARIOS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Test 1: ADD to Wishlist (from Home Page)"
echo "  1. Go to http://localhost:3000"
echo "  2. Login if not already"
echo "  3. Find a listing (not yours)"
echo "  4. Click heart icon â¤ï¸ (white)"
echo "  Expected:"
echo "    âœ“ Heart turns RED"
echo "    âœ“ Console: 'ğŸ”„ Adding to wishlist...'"
echo "    âœ“ Console: 'âœ… Added to wishlist'"
echo ""
echo "Test 2: REMOVE from Wishlist (from Home Page)"
echo "  1. On a listing with RED heart"
echo "  2. Click heart icon â¤ï¸ (red)"
echo "  Expected:"
echo "    âœ“ Heart turns WHITE"
echo "    âœ“ Console: 'ğŸ”„ Removing from wishlist...'"
echo "    âœ“ Console: 'âœ… Removed from wishlist'"
echo ""
echo "Test 3: VIEW Wishlist Page"
echo "  1. Click avatar â†’ 'Wish List'"
echo "  2. Or go to: http://localhost:3000/{userId}/wishlist"
echo "  Expected:"
echo "    âœ“ See all saved listings"
echo "    âœ“ Console: 'ğŸ“‹ Fetching details for X wishlist items...'"
echo "    âœ“ Console: 'âœ… Successfully loaded X wishlist items'"
echo ""
echo "Test 4: REMOVE from Wishlist Page"
echo "  1. On Wishlist page"
echo "  2. Click heart â¤ï¸ on any listing"
echo "  Expected:"
echo "    âœ“ Listing disappears immediately"
echo "    âœ“ Console: 'âœ… Removed from wishlist'"
echo "    âœ“ Console: 'ğŸ”„ WishList changed, re-fetching...'"
echo "    âœ“ Page auto-refreshes"
echo ""
echo "Test 5: Cannot Add Own Listing"
echo "  1. Find your own listing"
echo "  2. Try to click heart â¤ï¸"
echo "  Expected:"
echo "    âœ“ Console: 'âš ï¸ Cannot add own listing to wishlist'"
echo "    âœ“ Heart stays WHITE"
echo "    âœ“ No change"
echo ""
echo "Test 6: Must Be Logged In"
echo "  1. Logout"
echo "  2. Try to click heart â¤ï¸"
echo "  Expected:"
echo "    âœ“ Button is disabled (grayed out)"
echo "    âœ“ Cannot click"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ” DEBUGGING TIPS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Open DevTools (F12):"
echo ""
echo "1. Console Tab:"
echo "   Look for these messages:"
echo "   â€¢ 'ğŸ”„ Adding to wishlist...' or 'ğŸ”„ Removing from wishlist...'"
echo "   â€¢ 'âœ… Added to wishlist' or 'âœ… Removed from wishlist'"
echo "   â€¢ 'ğŸ“‹ Fetching details for X wishlist items...'"
echo "   â€¢ 'âœ… Successfully loaded X wishlist items'"
echo ""
echo "2. Network Tab:"
echo "   Check for:"
echo "   â€¢ PATCH request to /user/{userId}/{listingId}"
echo "   â€¢ Status: 200 OK"
echo "   â€¢ Response: { message: '...', wishList: [...] }"
echo ""
echo "3. Redux DevTools:"
echo "   Check:"
echo "   â€¢ Action: user/setWishList"
echo "   â€¢ Payload: Array of listing IDs"
echo "   â€¢ State: user.wishList updated"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âŒ COMMON ISSUES"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Issue: Heart doesn't change color"
echo "  â€¢ Check: User logged in?"
echo "  â€¢ Check: Console for errors"
echo "  â€¢ Check: Network tab - API call successful?"
echo "  â€¢ Fix: Clear cache, hard refresh (Cmd+Shift+R)"
echo ""
echo "Issue: 'Creator information not available'"
echo "  â€¢ This should ONLY appear when ADDING (not removing)"
echo "  â€¢ Check: Is it a new listing without creator?"
echo "  â€¢ Fix: Ensure listing has creator field populated"
echo ""
echo "Issue: Wishlist page doesn't update"
echo "  â€¢ Check: Redux DevTools - wishList updated?"
echo "  â€¢ Check: Console - 'ğŸ”„ WishList changed' message?"
echo "  â€¢ Fix: Restart client, clear cache"
echo ""
echo "Issue: Can't remove from wishlist page"
echo "  â€¢ Check: Console for errors"
echo "  â€¢ Check: Network - PATCH request sent?"
echo "  â€¢ This was the main bug - should be FIXED now!"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“š DOCUMENTATION"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "See docs folder for:"
echo "  â€¢ WISHLIST_COMPLETE_IMPLEMENTATION.md - Full guide"
echo "  â€¢ WISHLIST_FEATURE_FIXED_VI.md - Vietnamese guide"
echo "  â€¢ WISHLIST_FAVORITE_BUTTON_FIX.md - Button fix details"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸš€ Ready to test! Open http://localhost:3000 and try it out!"
echo ""
echo "Good luck! ğŸ€"
echo ""

